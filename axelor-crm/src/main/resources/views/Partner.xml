<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
 	
    <form name="incl-activities-partner-form" title="Partner" model="com.axelor.apps.base.db.Partner" >
	    <panel-dashlet name="partnerUpcomingEventsPanel" colSpan="12" action="action-partner-view-upcoming-events" height="800"/>
	    <panel-dashlet name="partnerHistoricalEventsPanel" colSpan="12" action="action-partner-view-historical-events-completed" height="800"/>
	</form>
	
	<form name="incl-activities-contact-form" title="Contact" model="com.axelor.apps.base.db.Partner" >
	    <panel-dashlet name="contactUpcomingEventsPanel" colSpan="12" action="action-contact-view-upcoming-events" height="800"/>
	    <panel-dashlet name="contactHistoricalEventsPanel" colSpan="12" action="action-contact-view-historical-events-completed" height="800"/>
	</form>
	
    <form name="incl-events-partner-form" title="Partner" model="com.axelor.apps.base.db.Partner" >
	    <panel-dashlet name="customerCrmActivitiesPanel" colSpan="12" title="Events" showIf="id != null" action="dashlet.customer.crm.activities" height="350"/>
	</form>
	
    <form name="incl-event-actions-partner-form" title="Partner" model="com.axelor.apps.base.db.Partner" id="incl-event-actions-crm-partner-form" >
        <menubar>
	        <menu name="partnerToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
	            <item name="scheduleEventItem" title="Schedule Event" action="save,action-partner-view-schedule-event" readonlyIf="id == null" if="__config__.app.isApp('crm')"/>
	            <item name="createOpportunityItem" title="Create opportunity" action="save,action-partner-view-create-opportunity" readonlyIf="id == null" if="__config__.app.isApp('crm')"/>
	            <item name="createOrderItem" title="Create sale quotation" action="save,action-partner-view-create-order" readonlyIf="id == null || id &lt; 1" if-module="axelor-sale" if="__config__.app.isApp('sale')" showIf="isProspect || isCustomer"/>
	            <item title="Create purchase quotation" action="save,action-partner-view-create-purchase-quotation" readonlyIf="id == null || id &lt; 1" if-module="axelor-purchase" if="__config__.app.isApp('purchase')" showIf="isSupplier"/>
	            <item name="generateProjectItem" title="Generate Project" action="action-partner-method-generate-project" readonlyIf="id == null || id &lt; 1" if-module="axelor-project" if="__config__.app.isApp('project')" hideIf="isContact"/>
	            <item name="sendEmailItem" title="Send email" action="save,action-send-by-email-with-template" readonlyIf="id == null" if-module="axelor-message" />
	            <item title="Customer recovery" name="customerRecoveryItem" action="action-partner-view-show-customer-debt-recovery" if="__config__.app.isApp('account')" />
	        </menu>
	        
	    </menubar>
    </form>
    
    <form id="crm-partner-form" name="partner-form" title="Partner" model="com.axelor.apps.base.db.Partner" extension="true">
    	<extend target="//panel[@name='socialNetworkPanel']">
    		<replace>
    			<panel name="socialNetworkPanel" colSpan="12" showIf="fullName != null">
					<button name="meetingBtn" help="Create a meeting" icon="fa-pencil-square-o" link="" onClick="save,action-partner-view-meeting-event" colSpan="2"/>
					<button name="callBtn" help="Create a call" icon="fa-phone" link="" onClick="save,action-partner-view-call-event" colSpan="2"/>
					<button name="noteBtn" help="Create a note" icon="fa-sticky-note-o" link="" onClick="save,action-partner-view-note-event" colSpan="2"/>
					<button name="emailBtn" help="Create an email" icon="fa-envelope-o" link="" onClick="save,action-send-by-email-with-template" colSpan="2"/>
				</panel>
    		</replace>
    	</extend>
    	<extend target="//panel[@name='activitiesPanel']">
    		<insert position="before">
    			<panel name="eventPanel" title="Events" showIf="id != null" if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('crm')">
    				<button name="showAllEventsBtn" title="Show all events" css="btn-custom text-left"
					icon="fa-tasks" onClick="action-partner-view-events" readonlyIf="id == null" />
					<panel-include view="incl-activities-partner-form"/>
    			</panel>
    			<panel-dashlet name="partnerOpportunitiesPanel" title="Opportunity" colSpan="12" action="action-partner-view-opportunities" height="800" showIf="id != null" if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('crm')"/>
    			<panel name="emailPanel" title="Emails" showIf="id != null" if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('crm')">
    				<panel-dashlet name="sentEmailsPanel" title="Sent emails" action="action-partner-method-view-sent-emails" colSpan="12" height="800"/>
    				<panel-dashlet name="receivedEmailsPanel" title="Received emails" action="action-partner-method-view-received-emails" colSpan="12" height="800"/>
    			</panel>
    			<panel name="marketingCampaignPanel" title="Marketing Campaign" showIf="id != null" if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('crm') &amp;&amp; __config__.app.isApp('marketing')">
					<panel-dashlet name="marketingCampaignsPanel" action="action-partner-view-marketing-campaigns" colSpan="12" height="800"/>	    				
    			</panel>
    		</insert>
    	</extend>
    	<extend target="//panel[@name='saleOrderCommentsPanel']">
    		<insert position="after">
    			<panel name="saleOrderPanel" colSpan="12" if="__config__.app.isApp('sale')" if-module="axelor-sale">
    				<panel-include view="incl-sales-partner-form"/>
				</panel>
    		</insert>
    	</extend>
    	<extend target="//panel[@name='purchaseOrderCommentsPanel']">
    		<insert position="after">
    			<panel name="purchaseOrderPanel" colSpan="12" if-module="axelor-purchase" if="__config__.app.isApp('purchase')">
    				<panel-include view="incl-purchases-partner-form"/>
				</panel>
    		</insert>
    	</extend>
    	<extend target="//panel[@name='activitiesPanel']">
    		<replace/>
    	</extend>
    	<extend target="//panel-include[@view='incl-event-actions-partner-form']">
    		<insert position="before">
    			<menubar>
			        <menu name="partnerToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
			            <item name="generateProjectItem" title="Generate Project" action="action-partner-method-generate-project" readonlyIf="id == null || id &lt; 1" if-module="axelor-project" if="__config__.app.isApp('project')" hideIf="isContact"/>
			            <item title="Customer recovery" name="customerRecoveryItem" action="action-partner-view-show-customer-debt-recovery" if="__config__.app.isApp('account')" />
			        </menu>
			    </menubar>
    		</insert>
    	</extend>
    	<extend target="//panel-include[@view='incl-event-actions-partner-form']">
    		<replace/>
    	</extend>
    	<extend target="//panel-include[@view='incl-sales-partner-form']">
    		<insert position="before">
    			<button name="createSaleOrderBtn" title="Create sale quotation" colSpan="4" onClick="save,action-partner-view-create-order" readonlyIf="id == null || id &lt; 1" showIf="isProspect || isCustomer"/>
    		</insert>
    	</extend>
    	<extend target="//panel-include[@view='incl-purchases-partner-form']">
    		<insert position="before">
    			<button name="createPurchaseOrderBtn" title="Create purchase quotation" colSpan="4" onClick="save,action-partner-view-create-purchase-quotation" readonlyIf="id == null || id &lt; 1" showIf="isSupplier"/>
    		</insert>
    	</extend>
    </form>
    
    <form id="crm-partner-contact-form" name="partner-contact-form" title="Contact" model="com.axelor.apps.base.db.Partner" extension="true">
    	<extend target="//panel[@name='socialNetworkPanel']">
    		<replace>
    			<panel name="socialNetworkPanel" colSpan="12">
					<button name="meetingBtn" help="Create a meeting" icon="fa-pencil-square-o" link="" onClick="save,action-partner-view-meeting-event" colSpan="2"/>
					<button name="callBtn" help="Create a call" icon="fa-phone" link="" onClick="save,action-partner-view-call-event" colSpan="2"/>
					<button name="noteBtn" help="Create a note" icon="fa-sticky-note-o" link="" onClick="save,action-partner-view-note-event" colSpan="2"/>
					<button name="emailBtn" help="Create an email" icon="fa-envelope-o" link="" onClick="save,action-send-by-email-with-template" colSpan="2"/>
				</panel>
    		</replace>
    	</extend>
    	<extend target="//panel[@name='activitiesPanel']">
    		<insert position="before">
    			<panel name="eventPanel" title="Events" showIf="id != null" if-module="axelor-crm" if="__config__.app.isApp('crm')">
    				<button name="showAllEventsBtn" title="Show all events" css="btn-custom text-left"
					icon="fa-tasks" onClick="action-contact-view-events" readonlyIf="id == null" />
					<panel-include view="incl-activities-contact-form"/>
    			</panel>
    			<panel name="saleOrderPanel" title="Sales orders" showIf="id != null" if-module="axelor-crm" if="__config__.app.isApp('crm') &amp;&amp; __config__.app.isApp('supplychain')">
    				<panel-include view="incl-sales-contact-form" />
    			</panel>
    			<panel name="emailPanel" title="Emails" showIf="id != null" if-module="axelor-crm" if="__config__.app.isApp('crm')">
    				<panel-dashlet name="sentEmailsPanel" title="Sent emails" action="action-partner-method-view-sent-emails" colSpan="12" height="800"/>
    				<panel-dashlet name="receivedEmailsPanel" title="Received emails" action="action-partner-method-view-received-emails" colSpan="12" height="800"/>
    			</panel>
    		</insert>
    	</extend>
    	<extend target="//panel[@name='activitiesPanel']">
    		<replace/>
    	</extend>
    	<extend target="//panel-include[@view='incl-event-actions-partner-form']">
    		<insert position="before">
    			<menubar>
			        <menu name="partnerToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
			            <item name="createOrderItem" title="Create sale quotation" action="save,action-partner-view-create-order" readonlyIf="id == null || id &lt; 1" if-module="axelor-sale" if="__config__.app.isApp('sale')" showIf="isProspect || isCustomer"/>
			            <item title="Create purchase quotation" action="save,action-partner-view-create-purchase-quotation" readonlyIf="id == null || id &lt; 1" if-module="axelor-purchase" if="__config__.app.isApp('purchase')" showIf="isSupplier"/>
			            <item name="generateProjectItem" title="Generate Project" action="action-partner-method-generate-project" readonlyIf="id == null || id &lt; 1" if-module="axelor-project" if="__config__.app.isApp('project')" hideIf="isContact"/>
			            <item title="Customer recovery" name="customerRecoveryItem" action="action-partner-view-show-customer-debt-recovery" if="__config__.app.isApp('account')" />
			        </menu>
			    </menubar>
    		</insert>
    	</extend>
    	<extend target="//panel-include[@view='incl-event-actions-partner-form']">
    		<replace/>
    	</extend>
    </form>
	
    <!--     CREATE CRM OBJECT FROM PARTNER -->
    
    <action-view name="action-partner-view-schedule-event" title="Schedule Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_partner" expr="eval: __this__"/>
    </action-view>
    
    <action-view name="action-contact-partner-view-schedule-event" title="Schedule Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_contactPartner" expr="eval: __this__"/>
    	<context name="_contactMainPartner" expr="eval: __this__.mainPartner" />
    </action-view> 
    
    <action-view name="action-partner-view-create-opportunity" title="Create opportunity (${ fullName })" model="com.axelor.apps.crm.db.Opportunity">
    	<view type="form" name="opportunity-form"/>
    	<context name="_partner" expr="eval: __this__"/>
		<context name="_internalUserId" expr="eval: __user__.id"/>
    </action-view>
    
    <action-view name="action-partner-view-meeting-event" title="Meeting Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_partner" expr="eval: __this__"/>
    	<context name="_meeting" expr="eval: true"/>
    </action-view>
    
    <action-view name="action-partner-view-call-event" title="Call Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_partner" expr="eval: __this__"/>
    	<context name="_call" expr="eval: true"/>
    </action-view>
    
    <action-view name="action-partner-view-note-event" title="Note Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_partner" expr="eval: __this__"/>
    	<context name="_note" expr="eval: true"/>
    </action-view>
    
    <!--  CREATE SALE OBJECT FROM PARTNER -->
    
    <action-view name="action-partner-view-create-order" title="Create order (${ fullName })" model="com.axelor.apps.sale.db.SaleOrder">
    	<view type="form" name="sale-order-form-partner"/>
    	<context name="_partner" expr="eval: __this__"/>
    </action-view>

    <!--  CREATE PURCHASE OBJECT FROM PARTNER -->

    <action-view name="action-partner-view-create-purchase-quotation" title="Create order (${ fullName })" model="com.axelor.apps.purchase.db.PurchaseOrder">
    	<view type="form" name="purchase-order-form"/>
    	<context name="_partner" expr="eval: __this__"/>
    </action-view>

    <!--     PORTLET -->
    
    <action-view name="action-partner-view-upcoming-events" title="Upcoming events" model="com.axelor.apps.crm.db.Event">
    	<view type="cards" name="event-cards"/>
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
		<domain>(self.partner.id = :id OR self.contactPartner.id = :id) and self.startDateTime &gt; :_todayTime</domain>
		<context name="id" expr="eval: id"/>
		<context name="_todayTime" expr="eval: __datetime__"/>
	</action-view>
	
	<action-view name="action-contact-view-upcoming-events" title="Upcoming events" model="com.axelor.apps.crm.db.Event">
		<view type="cards" name="event-cards"/>
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
		<domain>(self.contactPartner.id = :id) and self.startDateTime &gt; :_todayTime</domain>
		<context name="id" expr="eval: id"/>
		<context name="_todayTime" expr="eval: __datetime__"/>
	</action-view>
	
	<action-view name="action-partner-view-historical-events-completed" title="Historical events completed" model="com.axelor.apps.crm.db.Event">
		<view type="cards" name="event-cards"/>
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
		<domain>(self.partner.id = :id OR self.contactPartner.id = :id) and self.endDateTime &lt; :_todayTime</domain>
		<context name="id" expr="eval: id"/>
		<context name="_todayTime" expr="eval: __datetime__"/>
	</action-view>
	
	<action-view name="action-contact-view-historical-events-completed" title="Historical events completed" model="com.axelor.apps.crm.db.Event">
		<view type="cards" name="event-cards"/>
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
		<domain>(self.contactPartner.id = :id) and self.endDateTime &lt; :_todayTime</domain>
		<context name="id" expr="eval: id"/>
		<context name="_todayTime" expr="eval: __datetime__"/>
	</action-view>
   	
   	<action-view name="action-partner-view-opportunities" title="Opportunities" model="com.axelor.apps.crm.db.Opportunity">
   		<view type="cards" name="opportunity-cards"/>
		<view type="grid" name="opportunity-dashlet-grid"/>
		<view type="form" name="opportunity-form"/>
		<domain>self.partner.id = :id</domain>
		<context name="id" expr="eval: id"/>
	</action-view>
		
   	<action-view name="action-partner-view-events" title="Events" model="com.axelor.apps.crm.db.Event">
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
	  	<domain>self.partner.id = :_id</domain>
	</action-view>
	
	<action-view name="action-contact-view-events" title="Events" model="com.axelor.apps.crm.db.Event">
		<view type="grid" name="list-event-grid"/>
		<view type="form" name="event-form"/>
		<domain>self.contactPartner.id = :_id</domain>
	</action-view>
	
</object-views>
